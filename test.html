<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <title>MENU</title>
  <meta content="width=device-width, initial-scale=1" name="viewport">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap" rel="stylesheet">


  <link rel="stylesheet" href="css/style.css">
</head>

<body class="body">

  <div id="BLK_MENU"></div>

  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=601411f9821657146748f826" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="js/webflow.js" type="text/javascript"></script>
  <!-- [if lte IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/placeholders/3.0.2/placeholders.min.js"></script><![endif] -->
 
  <script type="text/javascript" language="javascript">  
    $(document).ready(function() {  

        //* ----------------------------------------------------------------------------------------------------
        //* Test si IndexDB est supporté par le navigateur
        //* ----------------------------------------------------------------------------------------------------

        if (!window.indexedDB) {
            console.log(`IndexedDB non supporté par le navigateur`);
            window.location.href = 'anomalie_indexeddb.html';
        } else {
            console.log(`IndexedDB supporté par le navigateur`);                 
        }

        //* ----------------------------------------------------------------------------------------------------
        //* Ouverture de la base de données SO POSING
        //*
        //* La méthode open() renvoie un objet de requête qui est une instance de l' IDBOpenDBRequest interface.
        //* ----------------------------------------------------------------------------------------------------

        const request = indexedDB.open('SOPOSING', 1);

        //* Détection d'une erreur sur l'ouverture de la base de données
        request.onerror = (event) => {
            console.error(`Erreur sur l'ouverture : ${event.target.errorCode}`);
        };

        //* La base de données est ouverte
        request.onsuccess = (event) => {

          let $ligne = '';
          let db = event.target.result;
          sessionStorage.setItem("db",db);

          getAllCategorie(db)
          .then(function(result){               
             result.forEach(categorie => {      
                $ligne += `<p>id categorie : ${categorie.id_categorie} - nom_categorie : ${categorie.nom_categorie} - actif : ${categorie.actif} </p>  </br> 
                <div class='categorie overlay' style="background: url(data:image/png;base64,${categorie.photo_categorie}) no-repeat center;"/>xxx</div>`;
             })
             document.getElementById("BLK_MENU").innerHTML = $ligne;
          })
          .catch(function(result){   
            console.log('KO');
          });
        };
  
        //* ----------------------------------------------------------------------------------------------------
        //* Liste des catégories
        //*
        //* Paramètres : nom de la base de données  
        //* ----------------------------------------------------------------------------------------------------

        async function getAllCategorie(db) {
            return new Promise(function(resolve, reject){
              const txn = db.transaction('categorie', "readonly");
              const objectStore = txn.objectStore('categorie');
              liste = [];

              objectStore.openCursor().onsuccess = (event) => {
                let cursor = event.target.result;
                if (cursor) {
                    let contact = cursor.value;
                    //console.log(contact);
                    liste.push(contact);
                    // continue next record
                    cursor.continue();
                } else {
                    resolve(liste);
                }
              };
            });
        };
 

    });
 

</script> 
</body>
</html>
</html>